# 语音情感识别客户端

现代化的Web客户端，提供实时语音转文字和情绪分析功能。

## 功能特性

### 🎯 核心功能
- **实时录音转文字**：支持中文、英文等多种语言的语音识别
- **情绪分析**：智能识别用户情绪状态（开心、悲伤、生气、中性等）
- **双模式支持**：
  - **SenseVoice模式**：一站式分析，支持7类情绪 + 事件检测
  - **Paraformer模式**：中文ASR + 4类情绪概率分析

### 🎨 UI特性
- **现代化设计**：渐变色彩、流畅动画、卡片式布局
- **实时波形可视化**：动态显示音频波形，支持颜色渐变
- **情绪可视化**：直观的情绪标签和概率条展示
- **历史记录**：自动保存分析历史，支持快速查看和回顾
- **响应式设计**：完美适配桌面和移动设备

### ⌨️ 交互特性
- **键盘快捷键**：
  - `空格键`：开始/停止录音
  - `ESC键`：停止录音
- **智能状态提示**：实时显示连接状态、录音状态、分析进度
- **错误处理**：友好的错误提示和自动恢复

## 使用方法

### 1. 启动服务器

```bash
# 在项目根目录
python -m uvicorn server.app:app --host 0.0.0.0 --port 8000
```

### 2. 打开客户端

在浏览器中访问：
```
http://localhost:8000/client/index.html
```

### 3. 开始使用

1. **选择分析模式**：在页面顶部选择 SenseVoice 或 Paraformer 模式
2. **开始录音**：点击"开始录音"按钮或按空格键
3. **说话**：对着麦克风说话，系统会自动检测语音
4. **查看结果**：语音结束后，系统会自动分析并显示结果
5. **查看历史**：在页面底部查看历史记录

## 浏览器要求

- **推荐浏览器**：Chrome 90+、Edge 90+、Firefox 88+
- **必需功能**：
  - Web Audio API
  - AudioWorklet（用于音频处理）
  - WebSocket（用于实时通信）
  - LocalStorage（用于历史记录）

## 技术架构

### 前端技术栈
- **HTML5**：语义化结构
- **CSS3**：现代化样式，CSS变量，动画效果
- **JavaScript (ES6+)**：模块化代码，异步处理

### 核心模块

#### `audio.js` - 音频采集
- 使用 Web Audio API 采集麦克风音频
- AudioWorklet 实时处理音频流
- 16kHz采样率，512样本分块

#### `websocket.js` - 通信管理
- WebSocket 实时双向通信
- 二进制音频数据传输
- 状态和结果消息处理

#### `ui.js` - 界面管理
- DOM操作和状态管理
- 波形可视化渲染
- 结果展示和历史记录管理

#### `app.js` - 主逻辑
- 整合各个模块
- 状态机管理
- 事件处理和错误处理

## 文件结构

```
client/
├── index.html          # 主页面
├── css/
│   └── style.css       # 样式文件
├── js/
│   ├── app.js          # 主逻辑
│   ├── audio.js        # 音频采集
│   ├── websocket.js    # WebSocket通信
│   ├── ui.js           # UI管理
│   └── audio-processor.js  # AudioWorklet处理器
└── README.md           # 本文档
```

## 常见问题

### Q: 无法访问麦克风？
A: 确保浏览器已授予麦克风权限，并在HTTPS或localhost环境下使用。

### Q: 波形不显示？
A: 检查浏览器是否支持AudioWorklet，推荐使用Chrome或Edge。

### Q: 连接失败？
A: 确保服务器已启动，并检查控制台错误信息。

### Q: 历史记录丢失？
A: 历史记录存储在浏览器LocalStorage中，清除浏览器数据会丢失。

## 开发说明

### 自定义样式
修改 `css/style.css` 中的CSS变量：
```css
:root {
  --accent-blue: #3b82f6;
  --accent-purple: #8b5cf6;
  /* ... */
}
```

### 扩展功能
- 在 `ui.js` 中添加新的UI组件
- 在 `app.js` 中添加新的业务逻辑
- 修改 `websocket.js` 扩展通信协议

## 许可证

与主项目保持一致。
